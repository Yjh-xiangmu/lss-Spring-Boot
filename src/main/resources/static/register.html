<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户注册 - 爱心互助社区</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 50%, #FFB347 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 40px 20px; }
        .container { background: white; border-radius: 25px; box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3); overflow: hidden; width: 100%; max-width: 900px; display: flex; animation: slideUp 0.6s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .left-panel { flex: 1; background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%); padding: 60px 40px; color: white; display: flex; flex-direction: column; justify-content: center; position: relative; overflow: hidden; }
        .left-panel::before { content: '❤️'; position: absolute; font-size: 200px; opacity: 0.1; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: heartbeat 2s ease-in-out infinite; }
        @keyframes heartbeat { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.1); } }
        .left-panel h1 { font-size: 36px; margin-bottom: 20px; font-weight: bold; position: relative; z-index: 1; }
        .left-panel p { font-size: 16px; line-height: 1.8; opacity: 0.95; position: relative; z-index: 1; }
        .left-panel .features { margin-top: 30px; position: relative; z-index: 1; }
        .feature-item { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .feature-item i { font-size: 20px; }
        .right-panel { flex: 1.2; padding: 50px 40px; max-height: 90vh; overflow-y: auto; }
        .register-title { font-size: 28px; color: #FF6B6B; margin-bottom: 10px; font-weight: bold; }
        .register-subtitle { color: #999; margin-bottom: 30px; font-size: 14px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; color: #333; font-size: 14px; font-weight: 500; }
        .form-label .required { color: #FF6B6B; }
        .form-input, .form-select { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; transition: all 0.3s; }
        .form-input:focus, .form-select:focus { outline: none; border-color: #FF6B6B; box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .skills-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .skill-checkbox { display: none; }
        .skill-label { padding: 8px 16px; background: #f5f5f5; border: 2px solid #e0e0e0; border-radius: 20px; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .skill-checkbox:checked + .skill-label { background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%); color: white; border-color: transparent; }
        .skill-label:hover { border-color: #FFB6B6; background: #fff5f5; }
        .skill-checkbox:checked + .skill-label:hover { background: linear-gradient(135deg, #FF8E53 0%, #FFB347 100%); }
        .btn-register { width: 100%; padding: 14px; background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; margin-top: 10px; }
        .btn-register:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4); }
        .login-link { text-align: center; margin-top: 20px; font-size: 14px; color: #666; }
        .login-link a { color: #FF6B6B; text-decoration: none; font-weight: bold; }
        .login-link a:hover { text-decoration: underline; }
        .input-hint { font-size: 12px; color: #999; margin-top: 5px; }
        .error-message { color: #ff4444; font-size: 13px; margin-top: 5px; display: none; }
        @media (max-width: 768px) { .container { flex-direction: column; } .left-panel { padding: 40px 30px; } .right-panel { padding: 40px 30px; max-height: none; } .form-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <div class="left-panel">
        <h1>加入我们</h1>
        <p>成为爱心互助社区的一员，用您的时间和技能帮助他人，传递温暖与希望。</p>
        <div class="features">
            <div class="feature-item"><i class="fas fa-check-circle"></i><span>参与/发布有意义的志愿活动</span></div>
            <div class="feature-item"><i class="fas fa-check-circle"></i><span>积累志愿服务时长</span></div>
            <div class="feature-item"><i class="fas fa-check-circle"></i><span>兑换精美礼品</span></div>
            <div class="feature-item"><i class="fas fa-check-circle"></i><span>结识志同道合的朋友</span></div>
        </div>
    </div>

    <div class="right-panel">
        <h2 class="register-title">账号注册</h2>
        <p class="register-subtitle">填写以下信息完成注册</p>

        <form id="registerForm">
            <div class="form-group">
                <label class="form-label">注册身份 <span class="required">*</span></label>
                <select class="form-select" id="userType" required onchange="toggleSkills()">
                    <option value="1">我是志愿者 (参与活动)</option>
                    <option value="2">我是组织者 (发布活动)</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">用户名 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="username" required minlength="4" maxlength="20" pattern="[a-zA-Z0-9]+">
                    <div class="input-hint">4-20位字母或数字</div>
                </div>
                <div class="form-group">
                    <label class="form-label">真实姓名/机构名 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="realName" required minlength="2" maxlength="10">
                    <div class="input-hint">2-10个汉字</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">密码 <span class="required">*</span></label>
                    <input type="password" class="form-input" id="password" required minlength="6" maxlength="20">
                    <div class="input-hint">6-20位</div>
                </div>
                <div class="form-group">
                    <label class="form-label">确认密码 <span class="required">*</span></label>
                    <input type="password" class="form-input" id="confirmPassword" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">手机号 <span class="required">*</span></label>
                    <input type="tel" class="form-input" id="phone" required pattern="1[3-9]\d{9}">
                    <div class="input-hint">11位有效手机号</div>
                </div>
                <div class="form-group">
                    <label class="form-label">身份证号 <span class="required">*</span></label>
                    <input type="text" class="form-input" id="idCard" required pattern="[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dX]">
                    <div class="input-hint">18位有效身份证号</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">所属/居住社区 <span class="required">*</span></label>
                <select class="form-select" id="community" required>
                    <option value="">请选择社区</option>
                    <option value="阳光社区">阳光社区</option>
                    <option value="和谐社区">和谐社区</option>
                    <option value="幸福社区">幸福社区</option>
                    <option value="温馨社区">温馨社区</option>
                    <option value="友爱社区">友爱社区</option>
                </select>
            </div>

            <div class="form-group" id="skillsContainer">
                <label class="form-label">擅长技能（多选）</label>
                <div class="skills-group">
                    <input type="checkbox" id="skill1" class="skill-checkbox" value="医疗急救"><label for="skill1" class="skill-label">医疗急救</label>
                    <input type="checkbox" id="skill2" class="skill-checkbox" value="心理咨询"><label for="skill2" class="skill-label">心理咨询</label>
                    <input type="checkbox" id="skill3" class="skill-checkbox" value="法律援助"><label for="skill3" class="skill-label">法律援助</label>
                    <input type="checkbox" id="skill4" class="skill-checkbox" value="摄影"><label for="skill4" class="skill-label">摄影</label>
                    <input type="checkbox" id="skill5" class="skill-checkbox" value="文案"><label for="skill5" class="skill-label">文案</label>
                    <input type="checkbox" id="skill6" class="skill-checkbox" value="其他"><label for="skill6" class="skill-label">其他</label>
                </div>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <button type="submit" class="btn-register">立即注册</button>
            <div class="login-link">已有账号？<a href="login.html">立即登录</a></div>
        </form>
    </div>
</div>

<script>
    // 切换身份时，组织者不需要填技能
    function toggleSkills() {
        const type = document.getElementById('userType').value;
        const skillsContainer = document.getElementById('skillsContainer');
        if(type === '2') {
            skillsContainer.style.display = 'none';
        } else {
            skillsContainer.style.display = 'block';
        }
    }

    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.style.display = 'none';

        const userType = parseInt(document.getElementById('userType').value);
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const realName = document.getElementById('realName').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const idCard = document.getElementById('idCard').value.trim().toUpperCase();
        const community = document.getElementById('community').value;

        // 如果是组织者，传空字符串；如果是志愿者，获取选中的技能
        const skills = userType === 2 ? '' : Array.from(document.querySelectorAll('.skill-checkbox:checked')).map(cb => cb.value).join(',');

        if (password !== confirmPassword) {
            showError('两次输入的密码不一致'); return;
        }

        // 手机号严格正则
        if (!/^1[3-9]\d{9}$/.test(phone)) {
            showError('请输入正确格式的手机号'); return;
        }
        // 身份证严格正则
        if (!/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dX]$/.test(idCard)) {
            showError('请输入正确格式的18位身份证号'); return;
        }

        try {
            const response = await fetch('http://localhost:8080/api/user/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: username,
                    password: password,
                    realName: realName,
                    phone: phone,
                    idCard: idCard,
                    community: community,
                    skills: skills,
                    userType: userType // 传给后端
                })
            });

            const result = await response.json();
            if (result.code === 200) {
                alert('注册成功！请登录');
                window.location.href = 'login.html';
            } else {
                showError(result.message || '注册失败');
            }
        } catch (error) {
            console.error('注册错误:', error);
            showError('网络错误，请检查后端服务是否启动');
        }
    });

    function showError(message) {
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
    }
</script>
</body>
</html>